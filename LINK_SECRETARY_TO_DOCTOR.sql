-- ============================================================================
-- ๐ ุฑุจุท ุงูุณูุฑุชูุฑุฉ ุจุงูุทุจูุจ
-- ============================================================================
-- ูุฐุง ุงูุณูุฑูุจุช ูุฑุจุท ุงูุณูุฑุชูุฑุฉ ุจุงูุทุจูุจ ุนุดุงู ุชูุฏุฑ ุชุดูู ุงูุจูุงูุงุช
-- ============================================================================

-- ========================================
-- ุงูุฎุทูุฉ 1: ุนุฑุถ ุฌููุน ุงูุฃุทุจุงุก
-- ========================================
SELECT 
  '๐จโโ๏ธ ูุงุฆูุฉ ุงูุฃุทุจุงุก' as title,
  id,
  name,
  email,
  user_role,
  created_at
FROM doctors
WHERE user_role = 'doctor'
ORDER BY name;

-- ========================================
-- ุงูุฎุทูุฉ 2: ุนุฑุถ ุฌููุน ุงูุณูุฑุชูุฑุงุช ูุญุงูุฉ ุงูุฑุจุท
-- ========================================
SELECT 
  '๐ฉโ๐ผ ูุงุฆูุฉ ุงูุณูุฑุชูุฑุงุช' as title,
  d.id,
  d.name,
  d.email,
  d.user_role,
  d.secretary_doctor_id,
  doc.name as doctor_name,
  CASE 
    WHEN d.secretary_doctor_id IS NOT NULL THEN 'โ ูุฑุจูุทุฉ ุจุทุจูุจ'
    ELSE 'โ ุบูุฑ ูุฑุจูุทุฉ - ูุฌุจ ุงูุฑุจุท!'
  END as status
FROM doctors d
LEFT JOIN doctors doc ON d.secretary_doctor_id = doc.id
WHERE d.user_role = 'secretary'
ORDER BY d.name;

-- ========================================
-- ุงูุฎุทูุฉ 3: ุฑุจุท ุงูุณูุฑุชูุฑุฉ ุจุงูุทุจูุจ
-- ========================================
-- โ๏ธ ูู ุจุชุนุฏูู ูุฐุง ุงูููุฏ ูุจู ุงูุชูููุฐ!
-- ุงุณุชุจุฏู <doctor_id> ุจู ID ุงูุทุจูุจ ูู ุงูุฎุทูุฉ 1
-- ุงุณุชุจุฏู <secretary_email> ุจุจุฑูุฏ ุงูุณูุฑุชูุฑุฉ ูู ุงูุฎุทูุฉ 2

/*
-- ูุซุงู ููุฑุจุท:
UPDATE doctors 
SET secretary_doctor_id = '<doctor_id>'
WHERE user_role = 'secretary' 
  AND email = '<secretary_email>';

-- ุฃู ูุฑุจุท ุฌููุน ุงูุณูุฑุชูุฑุงุช ุจููุณ ุงูุทุจูุจ:
UPDATE doctors 
SET secretary_doctor_id = '<doctor_id>'
WHERE user_role = 'secretary' 
  AND secretary_doctor_id IS NULL;
*/

-- ========================================
-- ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงูุฑุจุท
-- ========================================
SELECT 
  'โ ุงูุชุญูู ุงูููุงุฆู' as title,
  d.id,
  d.name as secretary_name,
  d.email as secretary_email,
  doc.id as doctor_id,
  doc.name as doctor_name,
  doc.email as doctor_email,
  CASE 
    WHEN d.secretary_doctor_id IS NOT NULL THEN 'โ ุงูุฑุจุท ุชู ุจูุฌุงุญ!'
    ELSE 'โ ุงูุณูุฑุชูุฑุฉ ูุง ุฒุงูุช ุบูุฑ ูุฑุจูุทุฉ'
  END as status
FROM doctors d
LEFT JOIN doctors doc ON d.secretary_doctor_id = doc.id
WHERE d.user_role = 'secretary'
ORDER BY d.name;

-- ========================================
-- ูุนูููุงุช ูููุฉ
-- ========================================
DO $$
BEGIN
  RAISE NOTICE '';
  RAISE NOTICE 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
  RAISE NOTICE '๐ ุฏููู ุฑุจุท ุงูุณูุฑุชูุฑุฉ ุจุงูุทุจูุจ';
  RAISE NOTICE 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
  RAISE NOTICE '';
  RAISE NOTICE '1๏ธโฃ ุดุงูุฏ ูุงุฆูุฉ ุงูุฃุทุจุงุก ูู ุงููุชูุฌุฉ ุงูุฃููู';
  RAISE NOTICE '2๏ธโฃ ุดุงูุฏ ูุงุฆูุฉ ุงูุณูุฑุชูุฑุงุช ูู ุงููุชูุฌุฉ ุงูุซุงููุฉ';
  RAISE NOTICE '3๏ธโฃ ุงูุณุฎ doctor_id ูู ุงููุงุฆูุฉ ุงูุฃููู';
  RAISE NOTICE '4๏ธโฃ ูู ุงูุชุนููู ุนู ุงูููุฏ ูู ุงูุฎุทูุฉ 3';
  RAISE NOTICE '5๏ธโฃ ุงุณุชุจุฏู <doctor_id> ู <secretary_email> ุจุงูููู ุงูุตุญูุญุฉ';
  RAISE NOTICE '6๏ธโฃ ููุฐ ุงูุณูุฑูุจุช ูุฑุฉ ุฃุฎุฑู';
  RAISE NOTICE '7๏ธโฃ ุดุงูุฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ููุชุฃูุฏ ูู ุงูุฑุจุท';
  RAISE NOTICE '';
  RAISE NOTICE '๐ก ุจุนุฏ ุงูุฑุจุทุ ุงูุณูุฑุชูุฑุฉ ุณุชูุฏุฑ:';
  RAISE NOTICE '   - ุชุดูู ูุฑุถู ุงูุทุจูุจ';
  RAISE NOTICE '   - ุชุญุฌุฒ ููุงุนูุฏ';
  RAISE NOTICE '   - ุชูุดุฆ ูุชุนุฏู ููุงุชูุฑ';
  RAISE NOTICE '   - ุชุฏูุฑ ุจูุงูุงุช ุงูุนูุงุฏุฉ';
  RAISE NOTICE '';
  RAISE NOTICE '๐ ุจุนุฏ ุงูุฑุจุทุ ุญุฏูุซ ุงูุตูุญุฉ (F5) ูุฌุฑุจ ุฒุฑ "ุงูููุงุชูุฑ"!';
  RAISE NOTICE 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
  RAISE NOTICE '';
END $$;

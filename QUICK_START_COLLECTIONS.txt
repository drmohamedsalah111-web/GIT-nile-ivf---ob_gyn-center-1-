═══════════════════════════════════════════════════════════════════════════════
  💰 نظام التحصيل والمقبوضات - ابدأ الآن بـ 3 خطوات
═══════════════════════════════════════════════════════════════════════════════

🚀 الخطوة 1️⃣: تشغيل SQL Migration
───────────────────────────────────────────────────────────────────────────────
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انشئ query جديدة
4. انسخ محتوى: CREATE_PAYMENT_RECORDS_TABLE.sql
5. اضغط Run ▶️

✅ سيتم إنشاء:
   - جدول invoice_payments (لتسجيل الدفعات)
   - حقول جديدة في جدول invoices (paid_amount, remaining_amount)
   - دوال تلقائية (auto-update)
   - Views للتقارير

═══════════════════════════════════════════════════════════════════════════════

🎯 الخطوة 2️⃣: الدخول من لوحة السكرتيرة
───────────────────────────────────────────────────────────────────────────────
1. السكرتيرة تدخل لوحتها
2. تضغط على: "التحصيل والمقبوضات" (في القائمة الجانبية)
3. ستظهر الفواتير المتبقية تلقائياً

أو من الصفحة الرئيسية اختر من navigation:
   ✓ نظرة عامة
   ✓ جدول المواعيد
   ✓ قاعة الانتظار
   ✓ سجل المرضى
   ✓ الفواتير
   ✓ التحصيل والمقبوضات 👈 هنا!

═══════════════════════════════════════════════════════════════════════════════

💵 الخطوة 3️⃣: تسجيل أول دفعة
───────────────────────────────────────────────────────────────────────────────
1. اختر tab "الفواتير المتبقية"
2. ابحث عن المريضة (بالاسم أو الهاتف)
3. اضغط زر "تحصيل" ⭐
4. في الـ popup:
   - أدخل المبلغ المدفوع
   - اختر طريقة الدفع (نقد/بطاقة/تحويل/تأمين)
   - أضف ملاحظة (اختياري)
5. اضغط "تسجيل الدفعة" ✅

بس كده! الفاتورة تحدثت تلقائياً!

═══════════════════════════════════════════════════════════════════════════════

📊 شو البيانات اللي بتشوفها:
───────────────────────────────────────────────────────────────────────────────

✓ إجمالي الفواتير: كام فاتورة الكل
✓ فواتير متبقية: كام فاتورة لسه ما اتدفعت
✓ فواتير مدفوعة: كام فاتورة دفعت كاملة
✓ مبالغ متبقية: كام ج.م بقت مستحقة

جدول معلومات:
┌────────────┬───────────┬────────┬──────────┬────────────┐
│ الفاتورة   │ الاسم     │ الهاتف │ المبلغ   │ الإجراء    │
├────────────┼───────────┼────────┼──────────┼────────────┤
│ INV001     │ أحمد      │ 123456 │ 5,000ج.م│ تحصيل ⭐  │
│ INV002     │ فاطمة     │ 234567 │ 3,000ج.م│ تحصيل ⭐  │
└────────────┴───────────┴────────┴──────────┴────────────┘

═══════════════════════════════════════════════════════════════════════════════

📋 Tabs Available:
───────────────────────────────────────────────────────────────────────────────
1️⃣  الفواتير المتبقية (Pending)
    - شوف الفواتير اللي ما اتدفعت
    - اضغط "تحصيل" لتسجيل دفعة

2️⃣  الفواتير المدفوعة (Paid)
    - شوف الفواتير اللي دفعت كاملة
    - لا تقدر تعدل عليها

3️⃣  التقارير (Reports)
    - نسبة التحصيل الكلية (%)
    - إجمالي المقبوضات (ج.م)
    - رسم بياني

═══════════════════════════════════════════════════════════════════════════════

🔍 خصائص البحث:
───────────────────────────────────────────────────────────────────────────────
• ابحث بـ اسم المريضة: "أحمد"
• ابحث برقم الهاتف: "123456"
• ابحث برقم الفاتورة: "INV001"

═══════════════════════════════════════════════════════════════════════════════

📥 تصدير البيانات:
───────────────────────────────────────────────────────────────────────────────
1. اضغط زر "تصدير" 📥
2. يتحمل ملف CSV
3. افتحه في Excel أو برنامج محاسبة

═══════════════════════════════════════════════════════════════════════════════

💳 طرق الدفع المدعومة:
───────────────────────────────────────────────────────────────────────────────
✓ نقد (Cash)
✓ بطاقة ائتمان (Visa)
✓ تحويل بنكي (Bank Transfer)
✓ تأمين (Insurance)

═══════════════════════════════════════════════════════════════════════════════

⚠️ ملاحظات مهمة:
───────────────────────────────────────────────────────────────────────────────
• كل سكرتيرة ترى فقط فواتير عيادة طبيبها
• الدفعات تُحفظ وتُؤرخ تلقائياً
• ما تقدر تحذف سجل دفعة (security - audit trail)
• المبلغ المدفوع يجب أن يكون ≤ المبلغ الكلي

═══════════════════════════════════════════════════════════════════════════════

🎓 أمثلة واقعية:
───────────────────────────────────────────────────────────────────────────────

مثال 1: دفعة كاملة
• فاتورة: INV001 = 5,000 ج.م
• المريضة: أحمد
• تدفع: 5,000 ج.م نقد
• النتيجة: الفاتورة اتحول للون الأخضر (مدفوعة) ✅

مثال 2: دفعة جزئية
• فاتورة: INV002 = 10,000 ج.م
• المريضة: فاطمة
• تدفع: 3,000 ج.م بطاقة
• النتيجة: المتبقي = 7,000 ج.م (تقدر تدفع باقي بعدين)

مثال 3: دفعات متعددة
• فاتورة: INV003 = 15,000 ج.م
• 1st payment: 5,000 ج.م
• 2nd payment: 5,000 ج.م
• 3rd payment: 5,000 ج.م
• النتيجة: مدفوعة بالكامل ✅

═══════════════════════════════════════════════════════════════════════════════

❓ الأسئلة الشائعة:
───────────────────────────────────────────────────────────────────────────────

س: شو إذا المريضة ما ركبت الفاتورة الجديدة على النظام؟
ج: شيء التحصيل ما بيظهر الفاتورة في القائمة. الفواتير بتنشاء من
   شاشة الفواتير الأساسية أولاً.

س: ممكن أعدّل دفعة قديمة؟
ج: لأ، الدفعات محفوظة وما تقدر تعديلها (امان مالي). لو في غلط
   اطلب من المدير.

س: شو إذا دخلت المبلغ غلط؟
ج: لأ يمكن تغيير سجل الدفع. لكن تقدر تضيف دفعة جديدة بالمبلغ
   الصحيح، والنظام يلخبط الحسابات.

س: كيف أشوف التقارير اليومية؟
ج: اذهب إلى tab "التقارير" وشوف:
   - نسبة التحصيل الكلية
   - إجمالي المقبوضات

═══════════════════════════════════════════════════════════════════════════════

🆘 بحاجة مساعدة؟
───────────────────────────────────────────────────────────────────────────────
1. افتح Browser Console (F12)
2. شوف الأخطاء باللون الأحمر
3. تأكد من تشغيل SQL migration من Supabase
4. أعد تحميل الصفحة (Ctrl+Shift+R)

═══════════════════════════════════════════════════════════════════════════════

✅ جاهز! ابدأ باستخدام النظام الآن!

النظام مصمم ليكون سهل وسريع. اي استفسار، اسأل! 🚀

═══════════════════════════════════════════════════════════════════════════════

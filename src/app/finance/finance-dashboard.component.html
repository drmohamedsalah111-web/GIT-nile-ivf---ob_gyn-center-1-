<div class="finance-dashboard">
  <h2>Finance Dashboard</h2>

  <div *ngIf="loading">Loading...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="!loading && summary">
    <div class="stats">
      <div><strong>Total today:</strong> {{ summary.totalPaymentsToday | number:'1.2-2' }}</div>
      <div><strong>Payments:</strong> {{ summary.countPaymentsToday }}</div>
      <div><strong>Services:</strong> {{ summary.countServicesToday }}</div>
    </div>

    <div class="actions">
      <button (click)="goNew()" [disabled]="todayClosed">New collection</button>
      <button (click)="goClose()" [disabled]="todayClosed">Close day</button>
      <span *ngIf="todayClosed"><strong>Closed</strong></span>
      <button (click)="refresh()">Refresh</button>
    </div>

    <h3>Today ledger</h3>
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Patient</th>
          <th>Service</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of ledger">
          <td>{{ r.payment.created_at }}</td>
          <td>{{ r.patient?.full_name || 'Unknown' }}</td>
          <td>{{ r.serviceName || '-' }}</td>
          <td>{{ r.payment.amount }}</td>
        </tr>
        <tr *ngIf="!ledger.length">
          <td colspan="4">No payments today</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>